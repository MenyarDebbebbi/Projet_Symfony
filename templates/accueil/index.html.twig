{% extends 'base.html.twig' %}
{% import '_components/ui_components.html.twig' as ui %}

{% block title %}Tableau de bord{% endblock %}

{% block body %}
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900">Tableau de bord</h1>
        <p class="mt-2 text-lg text-gray-600">Bienvenue dans votre système de gestion</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        {{ ui.stat_card('Livres', stats.livres, 'text-indigo-600', 'M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253', 'Voir tous les livres', path('app_livre_index')) }}
        
        {{ ui.stat_card('Auteurs', stats.auteurs, 'text-green-600', 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z', 'Voir tous les auteurs', path('app_auteur_index')) }}
        
        {{ ui.stat_card('Catégories', stats.categories, 'text-purple-600', 'M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z', 'Voir toutes les catégories', path('app_categorie_index')) }}
        
        {{ ui.stat_card('Éditeurs', stats.editeurs, 'text-yellow-600', 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4', 'Voir tous les éditeurs', path('app_editeur_index')) }}
        
        {{ ui.stat_card('Ouvriers', stats.ouvriers, 'text-blue-600', 'M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z', 'Voir tous les ouvriers', path('app_ouvrier_index')) }}
    </div>

    {% if recentLivres is defined and recentLivres|length > 0 %}
        <div class="mt-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Livres récents</h2>
                <p class="mt-1 text-sm text-gray-600">Les 5 derniers livres ajoutés</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for livre in recentLivres %}
                    {{ ui.livre_card(livre, path('app_livre_show', {'id': livre.id}), '', ui.priority_badge(livre.priorite)) }}
                {% endfor %}
            </div>
            <div class="mt-4 text-center">
                <a href="{{ path('app_livre_index') }}" class="text-sm font-medium text-indigo-600 hover:text-indigo-800 transition">
                    Voir tous les livres →
                </a>
            </div>
        </div>
    {% endif %}

    {% if categories is defined and categories|length > 0 %}
        <div class="mt-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Catégories</h2>
                <p class="mt-1 text-sm text-gray-600">Toutes les catégories disponibles</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for categorie in categories %}
                    {{ ui.categorie_card(categorie, path('app_categorie_show', {'id': categorie.id})) }}
                {% endfor %}
            </div>
            <div class="mt-4 text-center">
                <a href="{{ path('app_categorie_index') }}" class="text-sm font-medium text-purple-600 hover:text-purple-800 transition">
                    Voir toutes les catégories →
                </a>
            </div>
        </div>
    {% endif %}
    

    {% if editeurs is defined and editeurs|length > 0 %}
        <div class="mt-8">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Éditeurs</h2>
                <p class="mt-1 text-sm text-gray-600">Tous les éditeurs disponibles</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for editeur in editeurs %}
                    {{ ui.editeur_card(editeur, path('app_editeur_show', {'id': editeur.id})) }}
                {% endfor %}
            </div>
            <div class="mt-4 text-center">
                <a href="{{ path('app_editeur_index') }}" class="text-sm font-medium text-yellow-600 hover:text-yellow-800 transition">
                    Voir tous les éditeurs →
                </a>
            </div>
        </div>
    {% endif %}

    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
        {% set quick_actions = [
            {'text': '+ Nouveau livre', 'path': path('app_livre_new')},
            {'text': '+ Nouvel auteur', 'path': path('app_auteur_new')},
            {'text': '+ Nouvel éditeur', 'path': path('app_editeur_new')}
        ] %}
        {{ ui.quick_nav_section('Actions rapides', 'Créez rapidement de nouvelles entrées', quick_actions, 'bg-gradient-to-br from-indigo-500 to-indigo-700') }}

        {% set nav_links = [
            {'text': 'Livres', 'path': path('app_livre_index')},
            {'text': 'Auteurs', 'path': path('app_auteur_index')},
            {'text': 'Catégories', 'path': path('app_categorie_index')},
            {'text': 'Éditeurs', 'path': path('app_editeur_index')},
            {'text': 'Ouvriers', 'path': path('app_ouvrier_index'), 'span': true}
        ] %}
        {{ ui.grid_nav_section('Navigation', 'Accédez rapidement aux différentes sections', nav_links, 'bg-gradient-to-br from-purple-500 to-purple-700') }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <style>
        .card-details {
            transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .card-details.expanded {
            max-height: 1000px;
            opacity: 1;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Gestion de l'affichage des détails pour toutes les cartes
            const cardToggles = document.querySelectorAll('.card-toggle');
            
            cardToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    // Empêcher la propagation si on clique sur un lien
                    if (e.target.closest('a')) {
                        return;
                    }
                    
                    const targetId = this.getAttribute('data-target');
                    const detailsPanel = document.getElementById(targetId);
                    const icon = this.querySelector('[data-icon]');
                    
                    if (!detailsPanel) return;
                    
                    // Fermer tous les autres panneaux de détails
                    document.querySelectorAll('.card-details').forEach(panel => {
                        if (panel !== detailsPanel && panel.classList.contains('expanded')) {
                            panel.classList.remove('expanded');
                            panel.classList.add('hidden');
                            const otherToggle = document.querySelector(`[data-target="${panel.id}"]`);
                            if (otherToggle) {
                                const otherIcon = otherToggle.querySelector('[data-icon]');
                                if (otherIcon) {
                                    otherIcon.classList.remove('rotate-180');
                                }
                            }
                        }
                    });
                    
                    // Toggle le panneau actuel
                    if (detailsPanel.classList.contains('expanded')) {
                        detailsPanel.classList.remove('expanded');
                        setTimeout(() => {
                            detailsPanel.classList.add('hidden');
                        }, 300);
                    } else {
                        detailsPanel.classList.remove('hidden');
                        setTimeout(() => {
                            detailsPanel.classList.add('expanded');
                        }, 10);
                    }
                    
                    // Rotation de l'icône
                    if (icon) {
                        icon.classList.toggle('rotate-180');
                    }
                });
            });
        });
    </script>
{% endblock %}
